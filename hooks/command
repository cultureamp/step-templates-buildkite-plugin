#!/bin/bash
set -ueo pipefail

DIR="$(cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd)"

# shellcheck source=lib/shared.bash
. "$DIR/../lib/shared.bash"

template="$(plugin_read_config "TEMPLATE")"
selector="$(plugin_read_config "SELECTOR")"
auto_selections=()
raw_selections="$(plugin_read_list "AUTO_SELECTIONS")"
if [[ -n $raw_selections ]]; then
    readarray -t auto_selections <<< "$(plugin_read_list "AUTO_SELECTIONS")"
fi

if [[ -z "$template" ]] ; then
  echo "+++ ❌ Step templates plugin error"
  echo "No 'template' argument provided: cannot produce pipeline fragments without the template."
  exit 1
fi

if [[ -z "$selector" ]]  && [[ ${#auto_selections[@]} -eq 0 ]] ; then
  echo "+++ ❌ Step templates plugin error"
  echo "Neither selector nor auto_selections specified: nothing to do."
  exit 1
fi

# reverse order

# build
echo "

"
# selector
# auto-selections
